<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AI Photo Editor Platform</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase (NO AUTH USED) -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:system-ui;background:#0c0c0c;color:#fff}
header{background:#000;padding:14px;text-align:center}
.logo{font-size:22px;font-weight:700;color:#00ffd5}
.hidden{display:none}
main{padding:12px}
canvas{width:100%;background:#222;border-radius:14px;margin-top:10px}
button,input{padding:10px;border:none;border-radius:10px}
button{background:#00ffd5;font-weight:700;cursor:pointer}
.grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:12px}
.slider{grid-column:span 2}
.market{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.bg-item{height:80px;border-radius:10px;background-size:cover;cursor:pointer;position:relative}
.price{position:absolute;bottom:4px;right:4px;font-size:11px;background:#000;padding:3px 6px;border-radius:6px}
#audit{font-size:12px;color:#aaa;margin-top:10px}
footer{text-align:center;font-size:12px;color:#aaa;padding:10px}
</style>
</head>

<body>

<header>
  <div class="logo" id="brandName">AI Photo Editor</div>
  <div id="brandTag">Professional Editing Platform</div>
</header>

<!-- LICENSE -->
<div id="licenseBox" style="padding:20px;text-align:center">
  <h3>Enter License Key</h3>
  <input id="licenseKey" placeholder="XXXX-XXXX-XXXX">
  <button onclick="loadLicense()">Activate</button>
  <p id="licenseMsg"></p>
</div>

<main id="app" class="hidden">

<input type="file" id="upload" accept="image/*">
<canvas id="canvas"></canvas>

<div class="grid">

<div class="slider">Brightness
<input type="range" id="brightness" min="0" max="200" value="100">
</div>

<div class="slider">Contrast
<input type="range" id="contrast" min="0" max="200" value="100">
</div>

<button onclick="detectFace()">AI Face Detect</button>
<button onclick="toggleLandmarks()">Face Landmarks</button>

<button onclick="beauty()">AI Beauty</button>
<button onclick="removeBG()">Remove BG</button>

<button onclick="download()" style="grid-column:span 2">Download</button>

</div>

<h3>ðŸ–¼ Background Store</h3>
<div class="market" id="bgMarket"></div>

<div id="audit"></div>

</main>

<footer>Â© 2025 ABDI KIMUTAI BETT</footer>

<script>
/* FIREBASE */
firebase.initializeApp({
  apiKey:"PASTE_FIREBASE_KEY",
  projectId:"PROJECT_ID",
  storageBucket:"PROJECT.appspot.com"
});
const db=firebase.firestore();
const storage=firebase.storage();

/* GLOBAL STATE */
let ROLE="VIEWER";
let LANDMARKS=false;

/* LICENSE SYSTEM */
async function loadLicense(){
  let key=licenseKey.value;
  let doc=await db.collection("licenses").doc(key).get();
  if(!doc.exists){licenseMsg.innerText="Invalid License";return;}

  let d=doc.data();
  ROLE=d.role;
  brandName.innerText=d.brand;
  brandTag.innerText=d.tagline;

  licenseBox.classList.add("hidden");
  app.classList.remove("hidden");

  log(`License activated (${ROLE})`);
  loadBackgrounds();
}

/* CANVAS */
const canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d");
let img=new Image(),original=null;

upload.onchange=e=>{
  let r=new FileReader();
  r.onload=()=>img.src=r.result;
  r.readAsDataURL(e.target.files[0]);
};
img.onload=()=>{
  canvas.width=img.width;
  canvas.height=img.height;
  ctx.drawImage(img,0,0);
  original=ctx.getImageData(0,0,canvas.width,canvas.height);
  log("Image uploaded");
};

/* BASIC EDIT */
brightness.oninput=contrast.oninput=()=>{
  if(!original)return;
  let d=new ImageData(new Uint8ClampedArray(original.data),original.width,original.height);
  let b=brightness.value/100,c=contrast.value/100;
  for(let i=0;i<d.data.length;i+=4){
    d.data[i]*=b*c;d.data[i+1]*=b*c;d.data[i+2]*=b*c;
  }
  ctx.putImageData(d,0,0);
};

/* AI FACE DETECTION (REAL ML READY) */
async function detectFace(){
  log("Face detection requested");
  alert("Connect Face++ / MediaPipe / AWS Rekognition here.\nReturns landmarks & bounding boxes.");
}

/* LANDMARK OVERLAY */
function toggleLandmarks(){
  LANDMARKS=!LANDMARKS;
  if(LANDMARKS){
    ctx.strokeStyle="lime";
    ctx.strokeRect(100,80,150,180); // example
    log("Face landmarks shown");
  }
}

/* AI BEAUTY */
function beauty(){
  let d=ctx.getImageData(0,0,canvas.width,canvas.height);
  for(let i=0;i<d.data.length;i+=4){
    d.data[i]+=12;d.data[i+1]+=12;
  }
  ctx.putImageData(d,0,0);
  log("AI beauty applied");
}

/* REMOVE BG */
async function removeBG(){
  const KEY="PASTE_REMOVEBG_KEY";
  let blob=await new Promise(r=>canvas.toBlob(r));
  let f=new FormData();f.append("image_file",blob);
  let res=await fetch("https://api.remove.bg/v1.0/removebg",{method:"POST",headers:{"X-Api-Key":KEY},body:f});
  let b=await res.blob(),u=URL.createObjectURL(b);
  let i=new Image();
  i.onload=()=>{canvas.width=i.width;canvas.height=i.height;ctx.drawImage(i,0,0)};
  i.src=u;
  log("Background removed");
}

/* BACKGROUND STORE */
async function loadBackgrounds(){
  bgMarket.innerHTML="";
  let snap=await db.collection("backgrounds").get();
  snap.forEach(d=>{
    let bg=d.data();
    bgMarket.innerHTML+=`
      <div class="bg-item" style="background-image:url('${bg.url}')" onclick="applyBG('${bg.url}')">
        <div class="price">$${bg.price}</div>
      </div>`;
  });
}

function applyBG(url){
  let bg=new Image();
  bg.onload=()=>{
    ctx.globalCompositeOperation="destination-over";
    ctx.drawImage(bg,0,0,canvas.width,canvas.height);
    ctx.globalCompositeOperation="source-over";
  };
  bg.src=url;
  log("Background applied");
}

/* AUDIT LOG */
function log(msg){
  audit.innerHTML+=`â€¢ ${new Date().toLocaleTimeString()} â€“ ${msg}<br>`;
}

/* DOWNLOAD */
function download(){
  let a=document.createElement("a");
  a.download="edited.png";
  a.href=canvas.toDataURL();
  a.click();
  log("Image downloaded");
}
</script>

</body>
</html>
