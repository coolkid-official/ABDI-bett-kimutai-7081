<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Professional AI Photo Editor</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase (Database + Storage only) -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

<style>
/* ---------- DESIGN SYSTEM ---------- */
:root{
  --bg:#0b0d10;
  --panel:#13161b;
  --accent:#00ffd5;
  --text:#e6e6e6;
  --muted:#9aa0a6;
  --radius:14px;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
}

/* ---------- HEADER ---------- */
header{
  background:#000;
  padding:14px;
  text-align:center;
}
.logo{
  font-size:22px;
  font-weight:800;
  color:var(--accent);
}
.tagline{
  font-size:12px;
  color:var(--muted);
}

/* ---------- LAYOUT ---------- */
#licenseGate, main{
  max-width:1000px;
  margin:auto;
  padding:16px;
}
.hidden{display:none}

/* ---------- LICENSE ---------- */
#licenseGate{
  text-align:center;
}
#licenseGate input{
  width:100%;
  padding:12px;
  border-radius:var(--radius);
  border:none;
  margin:10px 0;
}
#licenseGate button{
  width:100%;
}

/* ---------- EDITOR ---------- */
.editor{
  display:grid;
  gap:16px;
}
canvas{
  width:100%;
  background:#222;
  border-radius:var(--radius);
}

/* ---------- TOOLBAR ---------- */
.toolbar{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:10px;
}
button{
  background:var(--accent);
  border:none;
  border-radius:var(--radius);
  padding:12px;
  font-weight:700;
  cursor:pointer;
}
button.secondary{
  background:#1f232a;
  color:var(--text);
}

/* ---------- SLIDERS ---------- */
.control{
  background:var(--panel);
  padding:12px;
  border-radius:var(--radius);
}
.control label{
  font-size:12px;
  color:var(--muted);
}
input[type=range]{width:100%}

/* ---------- MARKET ---------- */
.market{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(100px,1fr));
  gap:12px;
}
.bg{
  height:90px;
  border-radius:12px;
  background-size:cover;
  position:relative;
  cursor:pointer;
}
.bg span{
  position:absolute;
  bottom:6px;
  right:6px;
  font-size:11px;
  background:#000;
  padding:4px 6px;
  border-radius:6px;
}

/* ---------- AUDIT ---------- */
#audit{
  font-size:12px;
  color:var(--muted);
  background:var(--panel);
  padding:10px;
  border-radius:var(--radius);
}

/* ---------- FOOTER ---------- */
footer{
  text-align:center;
  font-size:11px;
  color:var(--muted);
  padding:10px;
}
</style>
</head>

<body>

<header>
  <div class="logo" id="brandName">AI Photo Editor</div>
  <div class="tagline" id="brandTag">Enterprise Visual Platform</div>
</header>

<!-- LICENSE -->
<section id="licenseGate">
  <h3>Activate License</h3>
  <input id="licenseInput" placeholder="LICENSE-XXXX-XXXX">
  <button onclick="activate()">Activate</button>
  <p id="licenseMsg"></p>
</section>

<!-- APP -->
<main id="app" class="hidden">
<div class="editor">

<input type="file" id="upload" accept="image/*">

<canvas id="canvas"></canvas>

<div class="toolbar">
  <button onclick="detectFace()">Face AI</button>
  <button onclick="toggleLandmarks()">Landmarks</button>
  <button onclick="beauty()">Beauty</button>
  <button onclick="removeBG()">Remove BG</button>
</div>

<div class="control">
  <label>Brightness</label>
  <input type="range" id="brightness" min="0" max="200" value="100">
</div>

<div class="control">
  <label>Contrast</label>
  <input type="range" id="contrast" min="0" max="200" value="100">
</div>

<button class="secondary" onclick="download()">Export Image</button>

<h3>Background Marketplace</h3>
<div class="market" id="market"></div>

<h3>Activity Log</h3>
<div id="audit"></div>

</div>
</main>

<footer>
© 2025 ABDI KIMUTAI BETT · Professional Edition
</footer>

<script>
/* ---------------- FIREBASE ---------------- */
firebase.initializeApp({
  apiKey:"PASTE_FIREBASE_KEY",
  projectId:"PROJECT_ID",
  storageBucket:"PROJECT.appspot.com"
});
const db=firebase.firestore();

/* ---------------- STATE ---------------- */
let ROLE="VIEWER", LANDMARKS=false;
const canvas=document.getElementById("canvas"),ctx=canvas.getContext("2d");
let img=new Image(),original=null;

/* ---------------- LICENSE ---------------- */
async function activate(){
  const key=licenseInput.value;
  const doc=await db.collection("licenses").doc(key).get();
  if(!doc.exists){licenseMsg.innerText="Invalid license";return;}
  const d=doc.data();
  ROLE=d.role;
  brandName.innerText=d.brand;
  brandTag.innerText=d.tagline;
  licenseGate.classList.add("hidden");
  app.classList.remove("hidden");
  log(`License activated (${ROLE})`);
  loadMarket();
}

/* ---------------- IMAGE ---------------- */
upload.onchange=e=>{
  const r=new FileReader();
  r.onload=()=>img.src=r.result;
  r.readAsDataURL(e.target.files[0]);
};
img.onload=()=>{
  canvas.width=img.width;
  canvas.height=img.height;
  ctx.drawImage(img,0,0);
  original=ctx.getImageData(0,0,canvas.width,canvas.height);
  log("Image loaded");
};

/* ---------------- CONTROLS ---------------- */
brightness.oninput=contrast.oninput=()=>{
  if(!original)return;
  let d=new ImageData(new Uint8ClampedArray(original.data),original.width,original.height);
  let b=brightness.value/100,c=contrast.value/100;
  for(let i=0;i<d.data.length;i+=4){
    d.data[i]*=b*c;d.data[i+1]*=b*c;d.data[i+2]*=b*c;
  }
  ctx.putImageData(d,0,0);
};

/* ---------------- AI ---------------- */
function detectFace(){
  log("Face detection request sent (ML API)");
  alert("Connect MediaPipe / Face++ / Azure Face API here.");
}
function toggleLandmarks(){
  LANDMARKS=!LANDMARKS;
  if(LANDMARKS){
    ctx.strokeStyle="lime";
    ctx.strokeRect(120,90,180,220);
    log("Landmarks displayed");
  }
}
function beauty(){
  let d=ctx.getImageData(0,0,canvas.width,canvas.height);
  for(let i=0;i<d.data.length;i+=4){
    d.data[i]+=10;d.data[i+1]+=10;
  }
  ctx.putImageData(d,0,0);
  log("Beauty enhancement applied");
}
async function removeBG(){
  log("Background removal requested");
  alert("remove.bg or custom ML pipeline hook");
}

/* ---------------- MARKET ---------------- */
async function loadMarket(){
  const snap=await db.collection("backgrounds").get();
  market.innerHTML="";
  snap.forEach(d=>{
    const b=d.data();
    market.innerHTML+=`
      <div class="bg" style="background-image:url('${b.url}')" onclick="applyBG('${b.url}')">
        <span>$${b.price}</span>
      </div>`;
  });
}
function applyBG(url){
  let bg=new Image();
  bg.onload=()=>{
    ctx.globalCompositeOperation="destination-over";
    ctx.drawImage(bg,0,0,canvas.width,canvas.height);
    ctx.globalCompositeOperation="source-over";
  };
  bg.src=url;
  log("Background applied");
}

/* ---------------- AUDIT ---------------- */
function log(m){
  audit.innerHTML+=`• ${new Date().toLocaleTimeString()} – ${m}<br>`;
}

/* ---------------- EXPORT ---------------- */
function download(){
  const a=document.createElement("a");
  a.download="export.png";
  a.href=canvas.toDataURL();
  a.click();
  log("Image exported");
}
</script>

</body>
</html>
